# Результаты и анализ бенчмарков

## Введение

Этот документ предоставляет детальный анализ и комментарии по использованию памяти и процессора двумя различными реализациями словарей: `Конкурентный словарь` и `Словарь на основе блокировок`, при различных уровнях конкуренции.

## Результаты бенчмарков

### Анализ потребления памяти:

| Метод               | Уровень конкуренции | Gen0 Коллекции | Gen1 Коллекции | Выделенная память |
|--------------------- |-----------------:|---------------:|-----------------:|-----------------:|
| GetRateConcurrent    | 10               |         0,2213 |               -  |        1,81 KB  |
| GetRateLock          | 10               |         0,2213 |               -  |        1,82 KB  |
| GetRateConcurrent    | 100              |         1,9531 |               -  |       15,87 KB  |
| GetRateLock          | 100              |         1,9531 |               -  |       15,88 KB  |
| GetRateConcurrent    | 1 000             |        19,5313 |          3,4180  |      156,53 KB  |
| GetRateLock          | 1 000             |        19,5313 |          3,1738  |      156,54 KB  |
| GetRateConcurrent    | 10 000            |       191,4063 |        105,4688  |    1 562,82 KB  |
| GetRateLock          | 10 000            |       191,4063 |        109,3750  |    1 562,82 KB  |
| UpdateRateConcurrent | 10               |         0,2441 |               -  |        1,99 KB  |
| UpdateRateLock       | 10               |         0,1831 |               -  |        1,53 KB  |
| UpdateRateConcurrent | 100              |         2,1973 |               -  |       18,19 KB  |
| UpdateRateLock       | 100              |         1,6479 |               -  |       13,49 KB  |
| UpdateRateConcurrent | 1 000             |        22,4609 |          3,4180  |      179,95 KB  |
| UpdateRateLock       | 1 000             |        16,1133 |          2,9297  |      133,08 KB  |
| UpdateRateConcurrent | 10 000            |       218,7500 |        109,3750  |    1 797,14 KB  |
| UpdateRateLock       | 10 000            |       156,2500 |        101,5625  |     1 328,4 KB  |

### Анализ процессора:

| Метод               | Уровень конкуренции | Среднее время (мкс) | Стандартное отклонение (мкс) | Операции в секунду (Оп/с) | Выполненные задания | Блокировки |
|--------------------- |-----------------:|---------------------:|-----------------------------:|-------------------------:|---------------------:|-----------:|
| GetRateConcurrent    | 10               |                2,930 |                       0,0358 |                  341 315,4 |               10,0063 |      0,0000 |
| GetRateLock          | 10               |                3,228 |                       0,0412 |                  309 761,6 |               10,0038 |      0,0000 |
| GetRateConcurrent    | 100              |               30,208 |                       0,1434 |                   33 104,1 |              100,0001 |      0,0005 |
| GetRateLock          | 100              |               27,899 |                       0,1218 |                   35 842,9 |              100,0001 |      0,0027 |
| GetRateConcurrent    | 1 000             |              246,232 |                       4,5886 |                    4 061,2 |            1 000,0000 |      0,0181 |
| GetRateLock          | 1 000             |              196,717 |                       1,1826 |                    5 083,5 |            1 000,0000 |      0,0171 |
| GetRateConcurrent    | 10 000            |            2 176,146 |                       9,6669 |                      459,5 |           10 000,0000 |          - |
| GetRateLock          | 10 000            |            1 827,250 |                      16,5329 |                      547,3 |           10 000,0000 |          - |
| UpdateRateConcurrent | 10               |                3,104 |                       0,0455 |                  322 193,9 |               10,0263 |      0,0001 |
| UpdateRateLock       | 10               |                4,796 |                       0,0814 |                  208 498,6 |               10,0037 |      0,0002 |
| UpdateRateConcurrent | 100              |               34,222 |                       0,4387 |                   29 220,9 |              100,0046 |      0,7422 |
| UpdateRateLock       | 100              |               48,976 |                       0,2207 |                   20 418,1 |              100,0001 |      0,0031 |
| UpdateRateConcurrent | 1 000             |              279,727 |                       3,5623 |                    3 574,9 |            1 000,0000 |      8,7139 |
| UpdateRateLock       | 1 000             |              429,681 |                       2,2272 |                    2 327,3 |            1 000,0000 |      0,0464 |
| UpdateRateConcurrent | 10 000            |            2 311,348 |                      20,3081 |                      432,6 |           10 000,0000 |     22,6016 |
| UpdateRateLock       | 10 000            |            4 076,800 |                      21,1503 |                      245,3 |           10 000,0000 |      0,0859 |

## Детальный анализ

### Потребление памяти:
- **Конкурентный словарь**:
   - В целом выделяет немного меньше памяти, чем словарь на основе блокировок, при низком уровне конкуренции.
   - На более высоких уровнях конкуренции (1 000 и 10 000) оба словаря выделяют примерно одинаковое количество памяти.
   - Количество сборок мусора Gen0 и Gen1 сопоставимо между двумя подходами, хотя `Конкурентный словарь` имеет немного больше сборок Gen0 на более высоких уровнях конкуренции, что указывает на немного большую текучесть памяти.

- **Словарь на основе блокировок**:
   - Выделение памяти практически на уровне с `Конкурентный словарь` при низком уровне конкуренции.
   - На более высоких уровнях конкуренции потребление памяти аналогично, хотя немного выше в плане выделенных байтов.
   - Немного меньше сборок Gen0 на более высоких уровнях конкуренции, что указывает на более эффективное использование памяти.

### Потребление процессора:
- **Конкурентный словарь**:
   - Лучше работает в отношении операций обновления на всех уровнях конкуренции.
   - При очень высоких уровнях конкуренции (1 000 и 10 000) `Конкурентный словарь` справляется с обновлениями гораздо эффективнее.
   - Для операций чтения он работает хорошо на низких уровнях конкуренции, но становится менее эффективным при очень высоких уровнях конкуренции по сравнению со словарем на основе блокировок.

- **Словарь на основе блокировок**:
   - В целом лучше работает при операциях чтения на высоких уровнях конкуренции (1 000 и 10 000).
   - Для операций обновления он всегда работает медленнее на всех уровнях конкуренции по сравнению с `Конкурентный словарь`.
   - Блокировки минимальны, но присутствуют, особенно заметны на более высоких уровнях конкуренции.

## Лучший выбор
- **Операции чтения**:
   - На низких и средних уровнях конкуренции `Конкурентный словарь` работает достаточно хорошо.
   - При очень высоких уровнях конкуренции `Словарь на основе блокировок` может быть более эффективным для операций чтения из-за меньшего среднего времени и большей пропускной способности.

- **Операции обновления**:
   - На всех уровнях конкуренции `Конкурентный словарь` является лучшим выбором для операций обновления благодаря лучшей производительности.

## Заключение
На основании анализа потребления памяти и процессора, `Конкурентный словарь` является в целом лучшим выбором, особенно для приложений с частыми обновлениями. Однако, если ваше приложение в основном читает данные и работает при очень высоких уровнях конкуренции, `Словарь на основе блокировок` может быть более эффективным для операций. Решение должно основываться на конкретном шаблоне использования и требованиях приложения к параллелизму.

## Методология

### Настройка тестов:

- Тесты проводились с использованием библиотеки [BenchmarkDotNet](https://benchmarkdotnet.org/).
- Каждый тест запускался при трех уровнях конкуренции: 10, 100, 1000 и 10000.
- Измерения включали выделения памяти, потребление процессора и количество операций в секунду.

### Окружение:

- Тесты запускались на машине со следующими характеристиками:
  - Процессор: AMD Ryzen 9 5980HS
  - Оперативная память: 32 ГБ
  - Операционная система: Windows 11

Для получения дополнительных сведений или вопросов, пожалуйста, откройте issue или свяжитесь с администратором репозитория.